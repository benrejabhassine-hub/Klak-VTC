<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KLAK - R√©servation VTC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #000000; color: white; font-family: sans-serif; }
        .klak-card { background: #111; border: 1px solid #333; border-radius: 20px; }
        .suggestion-box { position: absolute; z-index: 100; width: 100%; background: white; color: black; border-radius: 8px; display: none; max-height: 200px; overflow-y: auto; }
        .suggestion-item { padding: 12px; cursor: pointer; border-bottom: 1px solid #eee; font-size: 14px; }
        .suggestion-item:hover { background: #f0f0f0; }
        input[type="datetime-local"]::-webkit-calendar-picker-indicator { filter: invert(1); }
    </style>
</head>
<body class="p-4 flex flex-col items-center min-h-screen">

    <h1 class="text-5xl font-black italic mb-8 tracking-tighter">KLAK</h1>

    <div class="klak-card w-full max-w-md p-6 space-y-6">
        <div class="space-y-4">
            <div class="relative">
                <label class="text-yellow-400 text-[10px] uppercase font-bold">Lieu de d√©part</label>
                <input type="text" id="startInput" placeholder="Saisir l'adresse..." class="bg-transparent border-b border-gray-700 w-full py-2 outline-none text-sm">
                <div id="startSuggest" class="suggestion-box"></div>
            </div>

            <div class="relative">
                <label class="text-yellow-400 text-[10px] uppercase font-bold">Destination</label>
                <input type="text" id="endInput" placeholder="O√π allez-vous ?" class="bg-transparent border-b border-gray-700 w-full py-2 outline-none text-sm">
                <div id="endSuggest" class="suggestion-box"></div>
            </div>
        </div>

        <div>
            <label class="text-yellow-400 text-[10px] uppercase font-bold">Heure de d√©part</label>
            <input type="datetime-local" id="timeInput" class="bg-transparent border-b border-gray-700 w-full py-2 outline-none text-sm text-white">
        </div>

        <button onclick="calculateRide()" class="w-full bg-yellow-400 text-black font-black py-4 rounded-xl shadow-lg">
            CALCULER LE PRIX
        </button>

        <div id="priceDisplay" class="hidden border-2 border-yellow-400 p-4 rounded-2xl text-center bg-yellow-400/5">
            <p class="text-gray-400 text-xs">Distance : <span id="distVal">0</span> km</p>
            <p class="text-4xl font-black text-white" id="priceVal">-- ‚Ç¨</p>
        </div>

        <div id="orderZone" class="hidden space-y-4">
            <p class="text-center text-[10px] text-gray-500 uppercase font-bold">Envoyer au chauffeur</p>
            <div class="grid grid-cols-2 gap-3">
                <button onclick="sendToWA('336XXXXXXXX')" class="bg-white text-black p-4 rounded-xl font-bold text-sm">Chauffeur 1</button>
                <button onclick="sendToWA('336XXXXXXXX')" class="bg-white text-black p-4 rounded-xl font-bold text-sm">Chauffeur 2</button>
            </div>
        </div>
    </div>

    <script>
        let coords = { start: null, end: null };

        // Autocompl√©tion
        function initAuto(inputId, suggestId, type) {
            const input = document.getElementById(inputId);
            const suggest = document.getElementById(suggestId);
            input.addEventListener('input', async () => {
                if (input.value.length < 3) { suggest.style.display = 'none'; return; }
                const res = await fetch(`https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(input.value)}&limit=5`);
                const data = await res.json();
                suggest.innerHTML = '';
                data.features.forEach(f => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.innerText = f.properties.label;
                    div.onclick = () => {
                        input.value = f.properties.label;
                        coords[type] = f.geometry.coordinates;
                        suggest.style.display = 'none';
                    };
                    suggest.appendChild(div);
                });
                suggest.style.display = 'block';
            });
        }
        initAuto('startInput', 'startSuggest', 'start');
        initAuto('endInput', 'endSuggest', 'end');

        // Calcul du prix (Tes r√®gles)
        function calculateRide() {
            if (!coords.start || !coords.end) { alert("S√©lectionnez les adresses !"); return; }
            const lat1 = coords.start[1], lon1 = coords.start[0];
            const lat2 = coords.end[1], lon2 = coords.end[0];
            const dist = Math.sqrt(Math.pow(lat2-lat1, 2) + Math.pow(lon2-lon1, 2)) * 111 * 1.25;
            
            // Moins de 5km = 10‚Ç¨, sinon 3‚Ç¨ + 1.30‚Ç¨/km
            let prix = dist < 5 ? 10 : 3 + (dist * 1.3);
            
            document.getElementById('distVal').innerText = dist.toFixed(1);
            document.getElementById('priceVal').innerText = Math.ceil(prix) + " ‚Ç¨";
            document.getElementById('priceDisplay').classList.remove('hidden');
            document.getElementById('orderZone').classList.remove('hidden');
        }

        // WhatsApp
        function sendToWA(num) {
            const start = document.getElementById('startInput').value;
            const end = document.getElementById('endInput').value;
            const prix = document.getElementById('priceVal').innerText;
            const time = document.getElementById('timeInput').value.replace('T', ' √† ');
            const text = `üöï *KLAK - Nouvelle Course*%0AüìÖ *HEURE :* ${time}%0Aüìç *DEPART :* ${start}%0AüèÅ *ARRIVEE :* ${end}%0Aüí∞ *PRIX :* ${prix}`;
            window.open(`https://wa.me/${num}?text=${text}`, '_blank');
        }

        // Heure actuelle par d√©faut
        document.getElementById('timeInput').value = new Date(new Date().getTime() - new Date().getTimezoneOffset() * 60000).toISOString().slice(0, 16);
    </script>
</body>
</html>
